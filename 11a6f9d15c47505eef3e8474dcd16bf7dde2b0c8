{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "cb292ffd_f6879f18",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1002353
      },
      "writtenOn": "2025-10-27T01:53:14Z",
      "side": 1,
      "message": "Fix the config name from \"is-enable-log-timestamp\" to \"log-timestamp\".",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e3a94f8_8d58f464",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1001839
      },
      "writtenOn": "2025-11-06T03:02:25Z",
      "side": 1,
      "message": "I am not a user of the obmc-console log file, but in other context, I have found it dreadful to see my log file getting clobbered with timestamps. Those should really be part of the metadata/structured fields, like how you do structured logging in journald and defer displaying to another tool, journalctl.\n\nI think we could do something similar here. Instead of storing the timestamp data directly in-band, _maybe_ you could probably store it side-band in an `xxx.log.timestamp` file instead, like a database index file.\n\nEach line would store a pair of `timestamp len`, like\n\n```\n1762430400 0\n1762430460 512\n1762430520 1536\n1762430580 2048\n1762430640 2560\n```\n\nthen have a display tool that grab the `xxx.log` and `xxx.log.timestamp`, use the timestamp and len to slice the log file and display the log in the time axis.\n\nBonus point:\n\n- One that don\u0027t care about timestamp can still grab only the `xxx.log` file\n- You can pipe the `xxx.log` file into some terminal emulator lib and get accurate boundaries between text and terminal control code, that would help not slicing the log file at awkward position that might break the output.\n\nI have not thought of any reasons that this might not work.",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4be4cf0b_6969192a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000212
      },
      "writtenOn": "2025-11-06T03:27:05Z",
      "side": 1,
      "message": "\u003e\u003e You can pipe the xxx.log file into some terminal emulator lib and get accurate boundaries between text and terminal control code,\n\nThats a good use-case of maintaining a binary \"pure\" log file.\n\n\u003e\u003e Each line would store a pair of timestamp len, like\n\nNot liking this, since it would be a nightmare to maintain atomicity between the two files since they are both \"rotated\" at a fixed size. I would rather just duplicate the content into the .timestamp file.",
      "parentUuid": "9e3a94f8_8d58f464",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e67b29e8_efa6bdf5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1001839
      },
      "writtenOn": "2025-11-06T03:46:46Z",
      "side": 1,
      "message": "\u003e Not liking this, since it would be a nightmare to maintain atomicity between the two files since they are both \"rotated\" at a fixed size. I would rather just duplicate the content into the .timestamp file.\n\nI am not sure what atomicity between two files mean (may be consistency?), but I don\u0027t see the reason why you cannot rotate them in lockstep :) When you need to rotate one, you also rotate the other, whether it is the log file or timestamp file. `xxx.log` and `xxx.log.1` has `xxx.log.timestamp` and `xxx.log.1.timestamp`. Am I missing something here?",
      "parentUuid": "4be4cf0b_6969192a",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8c583545_4a89cf71",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1002353
      },
      "writtenOn": "2026-01-07T01:17:10Z",
      "side": 1,
      "message": "In cases such as power loss, BMC reset, or process crash, the log and timestamp files can easily become out of sync (e.g. missing or incorrect offsets), making the index unreliable.\n\nSo I think this approach may make things a bit more complicated.",
      "parentUuid": "e67b29e8_efa6bdf5",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "abf00f18_1caaa5c0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1001839
      },
      "writtenOn": "2026-01-07T03:26:50Z",
      "side": 1,
      "message": "Log rotation is supposed to solve that though. [systemd\u0027s journald](https://systemd.io/JOURNAL_FILE_FORMAT) does this:\n\n\u003e If any kind of corruption is noticed by a writer it should immediately rotate the file and start a new one. No further writes should be attempted to the original file, but it should be left around so that as little data as possible is lost.\n\nBut it is fair, I see obmc-console log rotation is currently very limited, so it might not be the most attractive solution to build upon. I still think it is more robust than filter through terminal escape sequences though, given its infamous complexities. I hope the parser in this changeset does not require much maintainance / change in the future, otherwise we are reimplementing `libvterm` or the more recent `libghostty-vt` inside `obmc-console` :D\n\n(Not a comment on the changeset itself so feel free to mark this comment as resolved.)",
      "parentUuid": "8c583545_4a89cf71",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "923471ac_8c3496ab",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 78,
      "author": {
        "id": 1000212
      },
      "writtenOn": "2025-10-29T20:02:13Z",
      "side": 1,
      "message": "Might be better if this was a member of `struct log_handler`.",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2fb5cac5_bdd5f4b0",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 78,
      "author": {
        "id": 1002353
      },
      "writtenOn": "2025-11-07T02:14:17Z",
      "side": 1,
      "message": "Sure, i will fix it.",
      "parentUuid": "923471ac_8c3496ab",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1022c7d9_42d1b10c",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 1000212
      },
      "writtenOn": "2025-10-29T20:02:13Z",
      "side": 1,
      "message": "Why not just have generate_timestamp() taken in a buf and a len instead of returning a pointer to a static buf and copy it? It could return the number of bytes it added to the buf. I would probably wrap this all up in a function called init_log_sentence()",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7d7687bd_be22cf1e",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 178,
      "author": {
        "id": 1002353
      },
      "writtenOn": "2025-11-07T02:14:17Z",
      "side": 1,
      "message": "Sure, i will fix it.",
      "parentUuid": "1022c7d9_42d1b10c",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f64e9c33_4f066f41",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 273,
      "author": {
        "id": 1000212
      },
      "writtenOn": "2025-10-29T20:02:13Z",
      "side": 1,
      "message": "@jk@ozlabs.org what do you think of a new config `logfile-timestamped \u003d /path/to/text/file`. \nWe will need a global config and a similar named section config for multiplexed consoles.",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee22da3b_e5e025e4",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 273,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2025-11-06T03:48:13Z",
      "side": 1,
      "message": "Yeah, I think it would be reasonable to create a separate text-friendly log stream for this. Whether that is timestamped or not could be configurable.\n\nSo maybe something like:\n\n```\nlogfile-text \u003d /path/to/text-log\nlogfile-text-timestamp \u003d true\n```\n\nConversion from the binary serial data to text-friendly is non-trivial though, we\u0027d need to define the conversion policy there. Perhaps starting with just replacing non-ASCII characters may be sufficient? You\u0027d still get the box-drawing characters (as they\u0027re just ASCII with a code switch), but that might be okay.\n\nWe could then do a more text-friendly log rotation too.",
      "parentUuid": "f64e9c33_4f066f41",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b105cb70_eaccc7eb",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 273,
      "author": {
        "id": 1002353
      },
      "writtenOn": "2025-11-07T02:14:17Z",
      "side": 1,
      "message": "Sure, Iâ€™ll follow your approach and start by replacing non-ASCII characters as you suggested.",
      "parentUuid": "ee22da3b_e5e025e4",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "da90b693_09b79212",
        "filename": "log-handler.c",
        "patchSetId": 6
      },
      "lineNbr": 273,
      "author": {
        "id": 1002353
      },
      "writtenOn": "2026-01-07T01:17:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b105cb70_eaccc7eb",
      "revId": "11a6f9d15c47505eef3e8474dcd16bf7dde2b0c8",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}