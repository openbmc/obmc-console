{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c8b3c413_bf46fead",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "Looks good - seeing as we don\u0027t have logrotate available, I\u0027m fine doing this within obmc-console (we will want to review that if we ever do include logrotate though).\n\nA couple of comments on the code, but they\u0027re fairly minor.",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c1df31a1_91780430",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "Even with logrotate, it depends on logrotate to be run timely. If the BMC receives too many SOL content in short time, the buffer will exeeds the size limit until logrotate to be run.\n\nThe code in obmc-console-server makes sure the log file does not exeeds the limit.",
      "parentUuid": "c8b3c413_bf46fead",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "468c81d2_41c010dd",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 41,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "use the convention above for the placement of \u0027*\u0027.",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "15300c15_88fd13d9",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 41,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "468c81d2_41c010dd",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "381c8f8c_8a7df7f8",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "This wording is a little ambiguous; maybe invert the logic:\n\n/* don\u0027t return, as we need to re-open the logfile */\n\nhowever, it\u0027s also possible to defer the close() until after you know the rotate is successful...\n\nall other comments in this project are C-style, would be good to keep that consistent.",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fcd06af7_0cc17cfe",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "Done.\n\nCould we rename the file without closing it?",
      "parentUuid": "381c8f8c_8a7df7f8",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e0b0a8bb_60e57c61",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 62,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T07:12:51Z",
      "side": 1,
      "message": "Yes, that\u0027s fine, but note that the fd will now refer to the renamed file.\n\nSo:\n\n- if the rename succeeds, you can close() the old fd and open(O_CREAT) the new file.\n\n- if the rename fails, you can lseek() and ftruncate().\n\n(continued in the next comment though)",
      "parentUuid": "fcd06af7_0cc17cfe",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc5770a4_0e5568a4",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 75,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "I don\u0027t think there\u0027s any need to exit (or even warn, really) here. The fd will be at offset zero, so the new log data will overwrite the old.",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0cc4bc85_5611c482",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 75,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "In case rename fails, the old file still exists and thus I need to truncate it.\nIn case it fails, make it return -1 so that log_data() will not write the data to the fd.",
      "parentUuid": "dc5770a4_0e5568a4",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec860ced_cf515b62",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 75,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T07:12:51Z",
      "side": 1,
      "message": "... in that latter case, where rename() fails, the only critical thing is the lseek(). If that fails, the file will continue to grow. If the ftruncate() fails, the old file content will remain, but will be overwritten as new log data is received - I don\u0027t think that should be an error, but happy either way if you have strong opinions on that.\n\n[keep in mind this is only relevant if the rename() also fails, so will be very rare!]",
      "parentUuid": "0cc4bc85_5611c482",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d9f6dc91_c426918d",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 75,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2022-03-30T07:26:45Z",
      "side": 1,
      "message": "In the case of the rename failing but the lseek succeeding we\u0027d avoid the problem of the log file growing too large, but wouldn\u0027t we then end up with the new problem of readers being unaware of the boundary between the new data at the start of the file and the old data following it?  That seems like it could lead to hard-to-predict awkwardness downstream (I certainly don\u0027t know offhand what rsyslog would do in that case).",
      "parentUuid": "ec860ced_cf515b62",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4115ec6_ad36e1a2",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 171,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "declarations at the top, for consistency.",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f3968ebb_bbb7b93f",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 171,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e4115ec6_ad36e1a2",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "de49c306_492e0c27",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "no need to cast",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "79937592_e846a01c",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 172,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "de49c306_492e0c27",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e5959fe6_d83d3932",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 173,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "just strcat here, no need to re-format.",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "478e5cd3_af01323f",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 173,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "Then it needs strcpy and strcat.\nI feel a bit simpler with snprintf()",
      "parentUuid": "e5959fe6_d83d3932",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6258b00e_ec6e64e8",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 173,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T07:12:51Z",
      "side": 1,
      "message": "OK, sure.",
      "parentUuid": "478e5cd3_af01323f",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "779788e4_823b1d75",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 188,
      "author": {
        "id": 1000016
      },
      "writtenOn": "2022-03-30T05:46:53Z",
      "side": 1,
      "message": "no need for the braces here",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bd2edeaf_a84b0b13",
        "filename": "log-handler.c",
        "patchSetId": 1
      },
      "lineNbr": 188,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2022-03-30T06:25:22Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "779788e4_823b1d75",
      "revId": "7d81d926a6a3e85f34e268ca8cce049363ecfb60",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}